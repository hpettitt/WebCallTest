{
  "nodes": [
    {
      "name": "Webhook",
      "type": "n8n-nodes-base.webhook",
      "parameters": {
        "path": "get-vapi-credentials",
        "responseMode": "responseNode",
        "options": {
          "allowUnauthorizedCerts": true,
          "responseHeaders": {
            "values": [
              {
                "name": "Access-Control-Allow-Origin",
                "value": "*"
              }
            ]
          }
        }
      }
    },
    {
      "name": "ValidateSession",
      "type": "n8n-nodes-base.function",
      "parameters": {
        "functionCode": "// Verify session token\nconst sessionToken = items[0].json.body.sessionToken;\n\n// Add your session validation logic here\nconst isValid = true; // Replace with actual validation\n\nif (isValid) {\n  // Return Vapi credentials (store these securely in n8n)\n  return [{\n    json: {\n      apiKey: process.env.VAPI_API_KEY,\n      assistantId: process.env.VAPI_ASSISTANT_ID,\n      candidateName: 'John Doe' // Replace with actual candidate name\n    }\n  }];\n} else {\n  return [{\n    json: {\n      error: 'Invalid session'\n    }\n  }];\n}"
      }
    },
    {
      "name": "Respond",
      "type": "n8n-nodes-base.respondToWebhook",
      "parameters": {
        "options": {
          "responseHeaders": {
            "values": [
              {
                "name": "Content-Type",
                "value": "application/json"
              }
            ]
          }
        }
      }
    }
  ],
  "connections": {
    "Webhook": {
      "main": [
        [
          {
            "node": "ValidateSession",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ValidateSession": {
      "main": [
        [
          {
            "node": "Respond",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  }
}